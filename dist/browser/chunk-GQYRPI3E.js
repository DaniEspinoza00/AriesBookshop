import{a as Q,b as W,c as mt,d as lt}from"./chunk-N5K7BZX6.js";import{c as A,d as G,g as U,j as R,k as J,l as K,m as f,n as X,o as Z,p as tt,q as et,r as nt,u as it,v as ot,w as rt,y as at}from"./chunk-CMM77Y2J.js";import"./chunk-QDCBMGO5.js";import{$ as q,$b as $,Ab as w,B as D,Bb as F,Cb as z,Db as h,Eb as b,Ka as B,Oa as a,W as S,Z as y,_ as E,_b as H,aa as V,bc as j,cb as s,cc as Y,e as ct,eb as m,ib as x,jb as i,kb as n,lb as u,nb as k,oa as v,ob as M,p as O,pb as _,qb as I,t as P,vb as r,wb as g,xb as L,z as T}from"./chunk-7LFF63BH.js";var N=ct(mt());function pt(t,o){t&1&&(i(0,"div",2),u(1,"mat-spinner",3),i(2,"span"),r(3,"Wait a moment..."),n()())}var ut=t=>["/product",t];function _t(t,o){if(t&1){let e=k();i(0,"tr")(1,"td",32)(2,"a",33),u(3,"img",34),n()(),i(4,"td",35)(5,"p"),r(6),n(),i(7,"p",36),r(8),n()(),i(9,"td")(10,"div",37)(11,"input",38),M("click",function(){let c=y(e).$implicit,p=_(3);return E(p.eliminateItem(c))}),n(),u(12,"input",39),i(13,"input",40),M("click",function(){let c=y(e).$implicit,p=_(3);return E(p.addItem(c))}),n()()(),i(14,"td",35)(15,"p"),r(16),h(17,"number"),n()(),i(18,"td",41)(19,"p"),r(20),h(21,"number"),n()()()}if(t&2){let e=o.$implicit;a(2),m("routerLink",z(14,ut,e.id)),a(),I("alt",e==null?null:e.title),m("src",e==null?null:e.image_url,B),a(3),g(e.title),a(2),g(e.authors),a(4),I("value",e.quantity),a(4),g(b(17,8,e.price,"1.2-2")),a(4),g(b(21,11,e.subtotal,"1.2-2"))}}function ft(t,o){t&1&&(i(0,"div",44),r(1,"Invalid Length. Must be at least 10 characters."),n())}function vt(t,o){t&1&&(i(0,"div",44),r(1,"Name is required."),n())}function Ct(t,o){if(t&1&&(i(0,"div",42),s(1,ft,2,0,"div",43)(2,vt,2,0,"div",43),n()),t&2){let e=_(3);a(),m("ngIf",e.cardName.errors==null?null:e.cardName.errors.minlength),a(),m("ngIf",e.cardName.errors==null?null:e.cardName.errors.required)}}function xt(t,o){t&1&&(i(0,"div",44),r(1,"Invalid Length. Must be at least 12 numbers."),n())}function gt(t,o){t&1&&(i(0,"div",44),r(1,"Invalid Length. Must be at least 16 numbers"),n())}function ht(t,o){t&1&&(i(0,"div",44),r(1,"Numbers required."),n())}function bt(t,o){if(t&1&&(i(0,"div",42),s(1,xt,2,0,"div",43)(2,gt,2,0,"div",43)(3,ht,2,0,"div",43),n()),t&2){let e=_(3);a(),m("ngIf",e.cardNumber.errors==null?null:e.cardNumber.errors.minlength),a(),m("ngIf",e.cardNumber.errors==null?null:e.cardNumber.errors.maxlength),a(),m("ngIf",e.cardNumber.errors==null?null:e.cardNumber.errors.required)}}function St(t,o){t&1&&(i(0,"div",44),r(1,"Expiration date is required."),n())}function yt(t,o){t&1&&(i(0,"div",44),r(1,"Invalid date format. Use YYYY-MM."),n())}function Et(t,o){if(t&1&&(i(0,"div",42),s(1,St,2,0,"div",43)(2,yt,2,0,"div",43),n()),t&2){let e=_(3);a(),m("ngIf",e.expDate.errors==null?null:e.expDate.errors.required),a(),m("ngIf",e.expDate.errors==null?null:e.expDate.errors.pattern)}}function Mt(t,o){t&1&&(i(0,"div",44),r(1,"CVV is required."),n())}function wt(t,o){t&1&&(i(0,"div",44),r(1,"Invalid Length. CVV ust be 3 numbers"),n())}function Pt(t,o){if(t&1&&(i(0,"div",42),s(1,Mt,2,0,"div",43)(2,wt,2,0,"div",43),n()),t&2){let e=_(3);a(),m("ngIf",e.cvv.errors==null?null:e.cvv.errors.required),a(),m("ngIf",e.cvv.errors==null?null:e.cvv.errors.minlength)}}function kt(t,o){if(t&1){let e=k();i(0,"button",45),M("click",function(){y(e);let d=_(3);return E(d.buyProducts())}),r(1,"BUY PRODUCTS"),n()}}function It(t,o){t&1&&(i(0,"button",46),r(1,"Please login"),n())}function Lt(t,o){if(t&1&&(i(0,"h1"),r(1,"Cart Items"),n(),i(2,"p",5),r(3),h(4,"number"),n(),i(5,"div",6)(6,"div",7)(7,"table",8)(8,"thead",9)(9,"tr",10)(10,"th",11)(11,"p"),r(12,"Book"),n()(),i(13,"th",11)(14,"p"),r(15,"Description"),n()(),i(16,"th",12)(17,"p"),r(18,"Quantity"),n()(),i(19,"th",11)(20,"p"),r(21,"Price"),n()(),i(22,"th",12)(23,"p"),r(24,"Subtotal"),n()()()(),i(25,"tbody"),s(26,_t,22,16,"tr",13),n()()(),i(27,"div",14)(28,"div",15)(29,"h4",16),r(30,"PAYMENT"),n(),i(31,"p",17),r(32),h(33,"number"),n(),i(34,"p",18),r(35,"Discounts: $0.00"),n(),i(36,"form",19)(37,"div",20)(38,"label",21),r(39,"Name on card"),n(),u(40,"input",22),s(41,Ct,3,2,"div",23),n(),i(42,"div",20)(43,"label",21),r(44,"Card number"),n(),u(45,"input",24),s(46,bt,4,3,"div",23),n(),i(47,"div",25)(48,"div",26)(49,"label",21),r(50,"Expiration Date"),n(),u(51,"input",27),s(52,Et,3,2,"div",23),n(),i(53,"div",28)(54,"label",21),r(55,"CVV"),n(),u(56,"input",29),s(57,Pt,3,2,"div",23),n()(),i(58,"div",30),s(59,kt,2,0,"button",31)(60,It,2,0),n()()()()()),t&2){let e=_(2);a(3),L("Total: $",b(4,9,e.total,"1.2-2"),""),a(23),m("ngForOf",e.productList),a(6),L("Total: $",b(33,12,e.total,"1.2-2"),""),a(4),m("formGroup",e.shopForm),a(5),m("ngIf",e.cardName.invalid&&(e.cardName.dirty||e.cardName.touched)),a(5),m("ngIf",e.cardNumber.invalid&&(e.cardNumber.dirty||e.cardNumber.touched)),a(6),m("ngIf",e.expDate.invalid&&(e.expDate.dirty||e.expDate.touched)),a(5),m("ngIf",e.cvv.invalid&&(e.cvv.dirty||e.cvv.touched)),a(2),x(59,e.userId!==0?59:60)}}var Nt=()=>["/books"];function Ot(t,o){t&1&&(i(0,"h3"),r(1,"Your Cart"),n(),i(2,"div",47),q(),i(3,"svg",48),u(4,"path",49),n(),V(),i(5,"p"),r(6,"You don't have any items in your cart, please add some by clicking in the button down below"),n(),i(7,"a",50),r(8,"Go to products"),n()()),t&2&&(a(7),m("routerLink",F(1,Nt)))}function Tt(t,o){if(t&1&&(i(0,"div",4),s(1,Lt,61,15)(2,Ot,9,2),n()),t&2){let e=_();a(),x(1,e.productList.length>0?1:2)}}var dt=(()=>{let o=class o{constructor(){this.total=0,this.userId=0,this.productList=[],this.isLoading=!1,this.saleList=[],this.LoginService=v(Q),this.CartService=v(W),this.formBuilder=v(rt),this.bookListService=v(U),this.router=v(A),this.salesService=v(lt),this.shopForm=this.formBuilder.group({cardName:["",[f.required,f.minLength(10)]],cardNumber:["",[f.required,f.minLength(12),f.maxLength(16)]],expDate:["",[f.required,f.pattern(/^\d{4}-\d{2}$/)]],cvv:["",[f.required,f.minLength(3)]]})}ngOnInit(){this.LoginService.userId.subscribe(l=>{this.userId=l}),this.CartService.products.pipe(P(l=>l.reduce((d,c)=>d+(c.subtotal||0),0))).subscribe(l=>{this.total=l}),this.CartService.products.subscribe(l=>{this.productList=l})}get cardName(){return this.shopForm.controls.cardName}get cardNumber(){return this.shopForm.controls.cardNumber}get expDate(){return this.shopForm.controls.expDate}get cvv(){return this.shopForm.controls.cvv}eliminateItem(l){this.CartService.eliminateProduct(l),this.ngOnInit()}addItem(l){this.CartService.addNewProduct(l),this.ngOnInit()}formatDate(l){let d=l.getDate(),c=l.getMonth()+1;return`${l.getFullYear()}-${c.toString().padStart(2,"0")}-${d.toString().padStart(2,"0")}`}buyProducts(){if(this.shopForm.invalid){alert("Llene todos los espacios");return}N.default.fire({title:"Confirmaci\xF3n",text:"\xBFEst\xE1 seguro de realizar la compra?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xED",confirmButtonColor:"#3085d6",cancelButtonText:"Cancelar",cancelButtonColor:"#d33"}).then(l=>{if(l.isConfirmed){let d=this.productList.map(c=>this.bookListService.getBookStockPrice(c.id).pipe(P(p=>{if(p.stock<c.quantity)throw new Error(`Stock insuficiente para el producto ${c.id}`);return p}),D(p=>O(p))));T(d).subscribe({next:c=>{if(c.some(C=>C instanceof Error)){N.default.fire({title:"Error",text:"No se pudo realizar la compra, stock insuficiente, revise por favor su carrito de compras",icon:"error",confirmButtonText:"Aceptar",cancelButtonColor:"#d33"});return}this.processSales()},error:c=>console.error("Error en la verificaci\xF3n de stock:",c)})}})}processSales(){let l=this.formatDate(new Date);this.productList.forEach(d=>{let c={date:l,idBook:d.id,idUser:this.userId,quantity:d.quantity,subtotal:d.subtotal};this.saleList.push(c)}),this.isLoading=!0,this.changeStock(this.saleList),this.salesService.postSales(this.saleList).subscribe({next:()=>{this.saleList=[],this.productList=[],this.CartService.cleanProducts(),setTimeout(()=>{this.isLoading=!1},5e3),this.router.navigateByUrl("/thanks")},error:d=>{console.log(d)}})}changeStock(l){l.forEach(d=>{let c=d.idBook;this.bookListService.getBookStockPrice(c).subscribe({next:p=>{this.bookListService.updateBook(p,d.quantity).subscribe({next:C=>{console.log(C)},error:C=>{console.log(C)}})}})})}};o.\u0275fac=function(d){return new(d||o)},o.\u0275cmp=S({type:o,selectors:[["app-cart"]],standalone:!0,features:[w],decls:2,vars:2,consts:[["class","full-screen-spinner d-flex flex-column justify-content-center align-items-center"],["class","container mt-5 mb-5"],[1,"full-screen-spinner","d-flex","flex-column","justify-content-center","align-items-center"],["diameter","50",1,"spinner"],[1,"container","mt-5","mb-5"],[2,"font-weight","bold"],[1,"row","justify-content-evenly"],[1,"col-lg-7","col-12"],[1,"table","table-striped"],[1,"table-header"],[1,"table-header-row"],["scope","col",1,"header-item"],["scope","col",1,"header-item",2,"text-align","center"],[4,"ngFor","ngForOf"],[1,"pay-form","col-lg-5","col-12"],[1,"pay-form-container"],[2,"font-weight","bolder","text-align","center"],[2,"font-size","30px"],[2,"font-size","25px"],[2,"margin-top","3rem",3,"formGroup"],[1,"mb-3"],["for","",1,"form-label"],["formControlName","cardName","type","text","name","","id","","placeholder","John Doe","required","",1,"form-control"],["class","text-danger",4,"ngIf"],["formControlName","cardNumber","type","text","name","","id","","placeholder","1111111111111111","required","",1,"form-control"],[1,"date-cvv","d-flex","justify-content-between","mb-3"],[1,"date"],["formControlName","expDate","type","month","name","","id","","required","",1,"form-control"],[1,"cvv"],["formControlName","cvv","type","text","maxlength","3","name","","id","","placeholder","123","required","",1,"form-control"],[1,"d-flex","flex-column","justify-content-center","mt-5"],["type","button","class","btn btn-primary"],["scope","row",1,"row-item"],[3,"routerLink"],[2,"max-width","60px",3,"src","alt"],[1,"row-item"],[1,"author"],[1,"input-group","w-auto","justify-content-center","align-items-center","mb-3"],["type","button","value","-","data-field","quantity",1,"button-minus","border","rounded-circle","icon-shape","icon-sm","mx-1",3,"click"],["type","text","name","quantity",1,"quantity-field","border-0","text-center","w-25",3,"value"],["type","button","value","+","data-field","quantity",1,"button-plus","border","rounded-circle","icon-shape","icon-sm",3,"click"],[1,"row-item",2,"text-align","center"],[1,"text-danger"],["class","input-error",4,"ngIf"],[1,"input-error"],["type","button",1,"btn","btn-primary",3,"click"],["type","button","disabled","",1,"btn","btn-secondary"],[1,"no-items","d-flex","flex-column","justify-content-center","align-items-center","mt-5"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-cart4"],["d","M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l.5 2H5V5zM6 5v2h2V5zm3 0v2h2V5zm3 0v2h1.36l.5-2zm1.11 3H12v2h.61zM11 8H9v2h2zM8 8H6v2h2zM5 8H3.89l.5 2H5zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0"],[1,"nav-link",3,"routerLink"]],template:function(d,c){d&1&&s(0,pt,4,0,"div",0)(1,Tt,3,1,"div",1),d&2&&(x(0,c.isLoading?0:-1),a(),x(1,c.isLoading?-1:1))},dependencies:[H,$,Y,j,G,at,tt,K,X,Z,it,ot,et,nt,J,R],styles:[".form-control[_ngcontent-%COMP%]{height:41px;background:#f2f2f2;box-shadow:none!important;border:none}.form-control[_ngcontent-%COMP%]:focus{background:#e2e2e2}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{border-radius:3px}.product[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:2rem}.icon-shape[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;text-align:center;vertical-align:middle}.icon-sm[_ngcontent-%COMP%]{width:2rem;height:2rem}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:hover{background-color:#fff}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.shopping-detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:gray;margin-bottom:0}.input-error[_ngcontent-%COMP%]{font-size:.8rem}.modal-content[_ngcontent-%COMP%]{max-height:80%}.pay-form-container[_ngcontent-%COMP%]{padding:10px 10px 25px;border:2px solid white;border-radius:10px;background:#fafafa;background:linear-gradient(153deg,#fafafa 43%,#4a3535 93%)}.no-items[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100px;height:100px;margin-bottom:3rem}.no-items[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding:10px;border-radius:15px;background-color:#432f2f;font-family:Alef,sans-serif}.no-items[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fffc}.no-items[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fff}@media screen and (max-width:575px){.header-item[_ngcontent-%COMP%]:nth-child(1), .row-item[_ngcontent-%COMP%]:nth-child(1){display:none}.table[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.8rem}.date-cvv[_ngcontent-%COMP%]{flex-direction:column}.date[_ngcontent-%COMP%]{width:50%}.cvv[_ngcontent-%COMP%]{width:30%}}@media screen and (max-width:400px){.button-minus[_ngcontent-%COMP%], .button-plus[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}}"]});let t=o;return t})();var Kt=(()=>{let o=class o{};o.\u0275fac=function(d){return new(d||o)},o.\u0275cmp=S({type:o,selectors:[["app-cart-page"]],standalone:!0,features:[w],decls:1,vars:0,template:function(d,c){d&1&&u(0,"app-cart")},dependencies:[dt]});let t=o;return t})();export{Kt as CartPageComponent};
